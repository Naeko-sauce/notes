# cfb加密

CFB（Cipher Feedback）模式是一种对称加密模式，用于将块密码转换为流密码。它与其他加密模式（如 ECB、CBC 等）不同之处在于，CFB 模式允许加密块的大小与输出流的大小不同，因此可以实现流加密。让我们详细解释 CFB 模式的工作原理，并通过示例来说明其加密和解密过程。

### CFB 模式工作原理：

在 CFB 模式中，加密算法被用于生成一个密钥流（keystream），然后将密钥流与明文进行异或操作，得到密文。这个密钥流的生成方式是使用加密算法对前一个密钥流进行加密，然后取部分或全部作为下一个密钥流的一部分。

#### 加密过程：

1. **初始化**：
   - 选择一个初始向量（IV），长度与加密算法的块大小相同。
   - 使用 IV 和加密密钥作为输入，使用加密算法生成初始的密钥流。

2. **生成密文**：
   - 对于每个明文字节（或位），执行以下步骤：
     a. 将当前密钥流的一部分与明文字节进行异或操作，得到密文字节。
     b. 将密文字节输出，并将其用作下一个密钥流的一部分。
     c. 使用加密算法对上一个密钥流进行加密，生成新的密钥流。

#### 解密过程：

CFB 模式的解密过程与加密过程类似，使用相同的初始向量和加密密钥，但将密文作为输入。对于每个密文字节，执行以下步骤：

1. **初始化**：
   - 使用相同的 IV 和加密密钥，使用加密算法生成初始的密钥流。

2. **解密密文**：
   - 对于每个密文字节，执行以下步骤：
     a. 将当前密钥流的一部分与密文字节进行异或操作，得到明文字节。
     b. 将明文字节输出，并将其用作下一个密钥流的一部分。
     c. 使用加密算法对上一个密钥流进行加密，生成新的密钥流。

### CFB 模式示例：

假设我们使用 AES 加密算法（块大小为 128 位）和固定的加密密钥来加密和解密一条消息。

- **明文消息**： "Hello, this is a secret message."
- **加密密钥**：假设为 `AESKey1234567890`
- **初始向量（IV）**：随机生成一个 IV

#### 加密过程：

1. **生成初始密钥流**：
   - 使用 IV 和加密密钥，使用 AES 加密算法生成初始的密钥流。

2. **加密明文**：
   - 对于每个明文字节，执行以下步骤：
     a. 从密钥流中取出一个字节与明文字节进行异或操作，得到密文字节。
     b. 将密文字节输出，并将其用作下一个密钥流的一部分。
     c. 使用 AES 加密算法对上一个密钥流进行加密，生成新的密钥流。

#### 解密过程：

1. **生成初始密钥流**：
   - 使用 IV 和加密密钥，使用 AES 加密算法生成初始的密钥流。

2. **解密密文**：
   - 对于每个密文字节，执行以下步骤：
     a. 从密钥流中取出一个字节与密文字节进行异或操作，得到明文字节。
     b. 将明文字节输出，并将其用作下一个密钥流的一部分。
     c. 使用 AES 加密算法对上一个密钥流进行加密，生成新的密钥流。

### 注意